<h3 class="welcomeMessage">
  {{ "WelcomeBack" | translate }}, {{ "Ahmed" | translate }}!
  <img src="assets/img/waving.svg" alt="Welcome Icon" class="welcomeIcon" />
</h3>
<p class="subMessage">{{ "HereIsYourTasksForToday" | translate }}</p>

<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <nz-spin nzSize="large"></nz-spin>
  <p>{{ 'Loading tasks...' | translate }}</p>
</div>

<!-- Error State -->
<nz-alert *ngIf="error" [nzMessage]="error" nzType="error" nzShowIcon></nz-alert>

<!-- Main Content -->
<div *ngIf="!loading && !error">
  <div class="titleActionHolder">
    <h1 class="pageTitle">{{ "ReviewerTaskList" | translate }}</h1>

    <div class="actionHolderTitle">
      <!-- Clean header - only search and filter -->
      <div class="seachInputHolder">
        <img src="./assets/img/search.svg" alt="" />
        <input 
          type="text" 
          [placeholder]="'Search by name, tax, email...' | translate"
          [ngModel]="searchTerm"
          (ngModelChange)="onSearchChange($event)" />
      </div>
      <select
        [(ngModel)]="filterByRecordType"
        (change)="onFilterChange($event)"
        class="filter-select">
        <option value="">{{ 'All Record Types' | translate }}</option>
        <option *ngFor="let type of uniqueRecordTypes" [value]="type">{{ type }}</option>
      </select>
      <button (click)="clearFilters()" class="btn btn-primary">{{ 'Clear Filters' | translate }}</button>
    </div>
  </div>

  <!-- Statistics Summary - Always visible -->
  <div class="statistics-summary">
    <nz-statistic 
      [nzValue]="newRequestsCount"
      [nzTitle]="'New Requests' | translate"
      [nzValueStyle]="{ color: '#faad14' }">
      <span nz-icon nzType="plus" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="quarantineCount"
      [nzTitle]="'Quarantine' | translate"
      [nzValueStyle]="{ color: '#fa8c16' }">
      <span nz-icon nzType="alert" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="duplicatesCount"
      [nzTitle]="'Duplicates' | translate"
      [nzValueStyle]="{ color: '#1890ff' }">
      <span nz-icon nzType="copy" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="totalTasksCount"
      [nzTitle]="'Total Tasks' | translate"
      [nzValueStyle]="{ color: '#52c41a' }">
    </nz-statistic>
  </div>

  <!-- Empty State - Removed to show table always -->

  <!-- Table -->
  <nz-table #basicTable [nzPageSize]="7" [nzData]="filteredTaskList" [nzScroll]="{ x: '1300px' }">
    <thead>
      <tr>
        <th style="min-width:120px">{{ 'Record Type' | translate }}</th>
        <th style="min-width:200px">{{ 'Company Name' | translate }}</th>
        <th style="min-width:140px">{{ 'Company Type' | translate }}</th>
        <th style="min-width:100px">{{ 'Date' | translate }}</th>
        <th style="min-width:120px">{{ 'Action' | translate }}</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let data of basicTable.data; let i = index">
        <!-- Record Type Column -->
        <td>
          <div style="display:flex; flex-direction:column; gap:4px;">
            <nz-tag [nzColor]="getOriginColor(data)">
              {{ getOriginBadge(data) }}
            </nz-tag>
            <small style="opacity:.7; font-size:11px">
              {{ getRecordOrigin(data) }}
            </small>
          </div>
        </td>

        <!-- Company Name -->
        <td>
          <div class="name-container">
            <strong>{{ data.firstName || data['name'] || '-' }}</strong>
            <div *ngIf="data.firstNameAr" class="arabic-name">{{ data.firstNameAr }}</div>
            <div *ngIf="data.tax" class="tax-number">
              <small style="opacity:.7">
                <i nz-icon nzType="number" style="margin-right:2px"></i>
                Tax: {{ data.tax }}
              </small>
            </div>
          </div>
        </td>

        <!-- Company Type Column -->
        <td>
          <div class="type-container">
            <span>{{ data['CustomerType'] || 'Customer Request' }}</span>
            <!-- Confidence score for duplicates -->
            <nz-tag *ngIf="isDuplicateRecord(data) && data.confidence" 
                    [nzColor]="getConfidenceColor(data.confidence)"
                    class="confidence-badge">
              {{ formatConfidence(data.confidence) }}
            </nz-tag>
          </div>
        </td>

        <!-- Date -->
        <td>{{ data.createdAt | date:'MMM d, y' }}</td>

        <!-- Actions - Unified "View Details" only -->
        <td>
          <div class="actionHolder">
            <!-- View Details Button - Universal for all request types -->
            <button nz-button nzType="primary" nzGhost nzSize="small"
                    nz-tooltip
                    [nzTooltipTitle]="getViewTooltip(data)"
                    (click)="viewOrEditRequest(data, false)"
                    class="view-details-btn">
              <span nz-icon nzType="eye"></span>
              {{ "View Details" | translate }}
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </nz-table>


</div>