<h3 class="welcomeMessage">
  {{ "WelcomeBack" | translate }}, {{ currentUser?.fullName || "Ahmed" }}!
  <img src="assets/img/waving.svg" alt="Welcome Icon" class="welcomeIcon" />
</h3>
<p class="subMessage">{{ "HereIsYourTasksForToday" | translate }}</p>

<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <nz-spin nzSize="large"></nz-spin>
  <p>{{ 'Loading tasks...' | translate }}</p>
</div>

<!-- Error State -->
<nz-alert *ngIf="error" [nzMessage]="error" nzType="error" nzShowIcon></nz-alert>

<!-- Main Content -->
<div *ngIf="!loading && !error">
  <div class="titleActionHolder">
    <h1 class="pageTitle">{{ "ReviewerTaskList" | translate }}</h1>

    <div class="actionHolderTitle">
      <!-- Clean header - only search and filter -->
      <div class="seachInputHolder">
        <img src="./assets/img/search.svg" alt="" />
        <input 
          type="text" 
          [placeholder]="'Search by name, tax, email...' | translate"
          [ngModel]="searchTerm"
          (ngModelChange)="onSearchChange($event)" />
      </div>
      <select
        [(ngModel)]="filterByRecordType"
        (change)="onFilterChange($event)"
        class="filter-select">
        <option value="">{{ 'All Record Types' | translate }}</option>
        <option *ngFor="let type of uniqueRecordTypes" [value]="type">{{ type }}</option>
      </select>
      <button (click)="clearFilters()" class="btn btn-primary">{{ 'Clear Filters' | translate }}</button>
    </div>
  </div>

  <!-- Statistics Summary - Always visible -->
  <div class="statistics-summary">
    <nz-statistic 
      [nzValue]="newRequestsCount"
      [nzTitle]="'New Requests' | translate"
      [nzValueStyle]="{ color: '#faad14' }">
      <span nz-icon nzType="plus" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="quarantineCount"
      [nzTitle]="'Quarantine' | translate"
      [nzValueStyle]="{ color: '#fa8c16' }">
      <span nz-icon nzType="alert" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="duplicatesCount"
      [nzTitle]="'Duplicates' | translate"
      [nzValueStyle]="{ color: '#1890ff' }">
      <span nz-icon nzType="copy" slot="prefix"></span>
    </nz-statistic>
    
    <nz-statistic 
      [nzValue]="totalTasksCount"
      [nzTitle]="'Total Tasks' | translate"
      [nzValueStyle]="{ color: '#52c41a' }">
    </nz-statistic>
  </div>

  <!-- Empty State - Removed to show table always -->

  <!-- Table -->
  <nz-table #basicTable [nzPageSize]="7" [nzData]="filteredTaskList" class="smart-table">
    <thead>
      <tr>
        <th class="record-type-header">{{ 'Record Type' | translate }}</th>
        <th class="company-name-header">{{ 'Company Name' | translate }}</th>
        <th class="company-type-header">{{ 'Company Type' | translate }}</th>
        <th class="date-header">{{ 'Date' | translate }}</th>
        <th class="action-header">{{ 'Action' | translate }}</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let data of basicTable.data; let i = index" class="table-row">
        <!-- Record Type Column -->
        <td class="record-type-cell">
          <div class="record-type-info">
            <nz-tag [nzColor]="getOriginColor(data)" class="record-type-tag">
              {{ getOriginBadge(data) }}
            </nz-tag>
            <small class="record-type-detail">
              {{ getRecordOrigin(data) }}
            </small>
          </div>
        </td>

        <!-- Company Name -->
        <td class="company-name-cell">
          <div class="company-info">
            <div class="company-name">
              <strong>{{ data.firstName || data['name'] || '-' }}</strong>
              <div *ngIf="data.firstNameAr" class="company-name-ar">{{ data.firstNameAr }}</div>
            </div>
            <div *ngIf="data.tax" class="company-details">
              <span class="tax-number">
                <i nz-icon nzType="number"></i>
                Tax: {{ data.tax }}
              </span>
            </div>
          </div>
        </td>

        <!-- Company Type Column -->
        <td class="company-type-cell">
          <div class="company-type-info">
            <span class="company-type">{{ data['CustomerType'] || 'Customer Request' }}</span>
            <!-- Confidence score for duplicates -->
            <nz-tag *ngIf="isDuplicateRecord(data) && data.confidence" 
                    [nzColor]="getConfidenceColor(data.confidence)"
                    class="confidence-badge">
              {{ formatConfidence(data.confidence) }}
            </nz-tag>
          </div>
        </td>

        <!-- Date -->
        <td class="date-cell">
          <span class="date-value">{{ data.createdAt | date:'MMM d, y' }}</span>
        </td>

        <!-- Actions - Unified "View Details" only -->
        <td class="action-cell">
          <button nz-button nzType="primary" nzGhost nzSize="small"
                  nz-tooltip
                  [nzTooltipTitle]="getViewTooltip(data)"
                  (click)="viewOrEditRequest(data, false)"
                  class="action-button">
            <span nz-icon nzType="eye"></span>
            {{ "View Details" | translate }}
          </button>
        </td>
      </tr>
    </tbody>
  </nz-table>


</div>