<!-- ÿ≤ÿ± ÿπÿßÿ¶ŸÖ ŸÑŸÅÿ™ÿ≠ / ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ¥ÿßÿ™ -->
<img
  src="assets/img/ChatBotButton.svg"
  alt="HSA Master Data Assistant"
  class="chat-float-button"
  (click)="toggleChat()"
/>

<!-- ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© -->
<div class="chat-box" *ngIf="isChatOpen">
  <!-- ÿßŸÑÿ±ÿ£ÿ≥ -->
  <div class="chat-header">
    <p>
      <img src="assets/img/aiIcon.svg" class="bot-avatar" />
      <span>{{ 'AIAssistant' | translate }}</span>
    </p>
    <button class="close-btn" (click)="toggleChat()">√ó</button>
  </div>

  <!-- ÿ¨ÿ≥ŸÖ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ -->
  <div class="chat-body" #chatContainer>
    <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ -->
    <ng-container *ngFor="let m of messages">
      <!-- ŸÅŸÇÿßÿπÿ© ÿ®Ÿàÿ™ -->
      <div class="chat-message" *ngIf="m.from==='bot'">
        <img src="assets/img/aiIcon.svg" class="bot-avatar" />
        <!-- ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ±ÿ≥ÿßŸÑÿ© ÿ∑ŸÑÿ® ŸÖÿ≥ÿ™ŸÜÿØ ŸÜÿ¨ÿπŸÑ ÿßŸÑŸÅŸÇÿßÿπÿ© ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑŸÜŸÇÿ± -->
        <div
          [ngClass]="'bot-message'"
          (click)="m.text.startsWith('üìë') ? fileInput.click() : null"
          style="cursor: pointer;"
        >
          {{ m.text }}
        </div>
      </div>
      
      <!-- Dropdown Options - ŸÖŸÜŸÅÿµŸÑ ÿ™ÿ≠ÿ™ ÿßŸÑÿ≥ÿ§ÿßŸÑ -->
      <div class="dropdown-container" *ngIf="m.from==='bot' && m.isDropdown && m.dropdownOptions && isDropdownOpen">
        <select 
          class="dropdown-select"
          (change)="onDropdownChange($event, m)"
          [value]="selectedDropdownValue"
        >
          <option value="" disabled>ÿßÿÆÿ™ÿ± ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©...</option>
          <option 
            *ngFor="let option of m.dropdownOptions" 
            [value]="option.value"
          >
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Button Options - ŸÖŸÜŸÅÿµŸÑ ÿ™ÿ≠ÿ™ ÿßŸÑÿ≥ÿ§ÿßŸÑ -->
      <div class="buttons-container" *ngIf="m.from==='bot' && m.isButtons && m.buttons">
        <button 
          *ngFor="let button of m.buttons" 
          class="action-button"
          [class.yes-button]="button.type === 'yes'"
          [class.no-button]="button.type === 'no'"
          [class.skip-button]="button.type === 'skip'"
          (click)="onButtonClick(button.value, button.type)">
          {{ button.text }}
        </button>
      </div>


      <!-- ŸÅŸÇÿßÿπÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ -->
      <div class="chat-message user-reverse" *ngIf="m.from==='user'">
        <div class="user-message">{{ m.text }}</div>
      </div>
    </ng-container>
  </div>

  <!-- ŸÇÿØŸÖ ÿßŸÑÿ¥ÿßÿ™ -->
  <div class="chat-footer">
    <!-- File Upload Area -->
    <div class="file-upload-area" 
         *ngIf="awaitingFile"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onDrop($event)"
         [class.drag-over]="isDragOver">
      <div class="upload-content">
        <div class="upload-icon">üìÅ</div>
        <p class="upload-text">{{ t('UploadPrompt') }}</p>
        <p class="upload-hint">{{ t('UploadHint') }}</p>
        <div class="upload-buttons">
          <button class="upload-btn" (click)="fileInput.click()">
            {{ t('SelectFile') }}
          </button>
          <button class="cancel-upload-btn" (click)="cancelUpload()">
            {{ t('Cancel') }}
          </button>
        </div>
      </div>
    </div>

    <!-- Regular Chat Input -->
    <div class="text-input-area" *ngIf="!awaitingFile">
      <input
        [(ngModel)]="currentInput"
        (keydown.enter)="send()"
        [placeholder]="'WriteSomething' | translate"
        [disabled]="isAiProcessing"
      />
      <button type="button" (click)="openFilePicker()" [disabled]="isAiProcessing" class="file-picker-btn" title="Upload File">
        üìé
      </button>
      <button (click)="send()" [disabled]="isAiProcessing">
        <img *ngIf="!isAiProcessing" src="assets/img/send.svg" alt="send" />
        <span *ngIf="isAiProcessing" class="loading-spinner">‚è≥</span>
      </button>
    </div>
  </div>
</div>

<!-- input ÿÆŸÅŸä ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÑŸÅÿßÿ™ -->
<input #fileInput type="file" style="display:none"
       (change)="onFileSelected($event)"
       [accept]="getFileAcceptTypes()" />