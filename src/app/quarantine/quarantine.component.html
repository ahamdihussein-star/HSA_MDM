<div class="titleActionHolder">
  <h1 class="pageTitle">{{ "Quarantine Data (Incomplete Records)" | translate }}</h1>

  <div class="actionHolderTitle">
    <div class="seachInputHolder">
      <img src="./assets/img/search.svg" alt="" />
      <input
        type="text"
        [placeholder]="'Search by name, tax, email...' | translate"
        [value]="q"
        (input)="onSearch($any($event.target).value)" />
    </div>
    <select 
      [(ngModel)]="filterBySource" 
      (change)="onFilterChange($event)"
      class="filter-select">
      <option value="">{{ 'All Sources' | translate }}</option>
      <option *ngFor="let source of uniqueSourceSystems" [value]="source">{{ source }}</option>
    </select>
    <button (click)="clearFilters()" class="btn btn-primary">{{ 'Clear Filters' | translate }}</button>
  </div>
</div>

<!-- Summary Statistics - Beautiful Design -->
<div *ngIf="!loading && rows.length > 0" class="stats-container">
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-number">{{ total }}</div>
      <div class="stat-label">{{ 'Total Records' | translate }}</div>
    </div>
    
    <div class="stat-card quarantine">
      <div class="stat-number">{{ fromQuarantineCount }}</div>
      <div class="stat-label">{{ 'Original Quarantine' | translate }}</div>
    </div>
    
    <div class="stat-card duplicates">
      <div class="stat-number">{{ fromDuplicateCount }}</div>
      <div class="stat-label">{{ 'From Duplicates' | translate }}</div>
    </div>
    
    <div class="stat-card sap-s4">
      <div class="stat-number">{{ sapS4HanaCount }}</div>
      <div class="stat-label">{{ 'SAP S/4HANA' | translate }}</div>
    </div>
    
    <div class="stat-card sap-byd">
      <div class="stat-number">{{ sapByDCount }}</div>
      <div class="stat-label">{{ 'SAP ByD' | translate }}</div>
    </div>
    
    <div class="stat-card oracle">
      <div class="stat-number">{{ oracleFormsCount }}</div>
      <div class="stat-label">{{ 'Oracle Forms' | translate }}</div>
    </div>
  </div>
</div>

<!-- Table using nz-table for consistency -->
<nz-table #basicTable [nzData]="filtered" [nzLoading]="loading" [nzScroll]="{ x: '100%', y: 'calc(100vh - 400px)' }" [nzPageSize]="50" nzTableLayout="fixed">
  <thead>
    <tr>
      <th style="min-width:200px">{{ "Company Name" | translate }}</th>
      <th style="min-width:100px">{{ "Company Type" | translate }}</th>
      <th style="min-width:140px">{{ "Source System" | translate }}</th>
      <th style="min-width:200px">{{ "Missing Fields" | translate }}</th>
      <th style="min-width:120px">{{ "Actions" | translate }}</th>
    </tr>
  </thead>

  <tbody>
    <!-- Empty state row -->
    <tr *ngIf="!loading && (!filtered || filtered.length === 0)">
      <td colspan="5" style="text-align: center; padding: 40px;">
        <nz-empty [nzNotFoundContent]="'No quarantine records found' | translate"></nz-empty>
      </td>
    </tr>

    <!-- Data rows -->
    <tr *ngFor="let r of basicTable.data; trackBy: trackById">
      <td>
        <div style="display:flex; flex-direction:column;">
          <strong>{{ r.firstName || 'â€”' }}</strong>
          <small *ngIf="r.firstNameAr" style="opacity:.7">{{ r.firstNameAr }}</small>
          <small *ngIf="r.tax" style="opacity:.7; margin-top:2px">
            <i nz-icon nzType="number" nzTheme="outline" style="margin-right:2px"></i>
            Tax: {{ r.tax }}
          </small>
        </div>
      </td>

      <td>
        <nz-tag>{{ r.CustomerType || 'Unknown' }}</nz-tag>
      </td>

      <td>
        <nz-tag [nzColor]="r.sourceSystem?.includes('SAP') ? 'blue' : 
                          r.sourceSystem?.includes('Oracle') ? 'red' : 
                          'default'">
          {{ getSourceBadgeText(r.sourceSystem) }}
        </nz-tag>
      </td>

      <td>
        <div [title]="r.missingFields?.join(', ')">
          <nz-tag nzColor="warning">
            {{ getMissingFieldsCount(r) }} {{ 'missing' | translate }}
          </nz-tag>
          <div style="font-size:11px; margin-top:4px; opacity:.7">
            {{ getMissingFieldsDisplay(r) }}
          </div>
        </div>
      </td>

      <td>
        <button nz-button nzType="primary" nzSize="small" (click)="completeRecord(r)">
          <i nz-icon nzType="edit"></i>
          {{ "Fix" | translate }}
        </button>
      </td>
    </tr>
  </tbody>
</nz-table>
