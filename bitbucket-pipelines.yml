image: node:16

pipelines:
  branches:
   staging:
    - step:
        name: Install Dependencies
        caches:
          - node
        script:
          - npm install --f 

    - step:
        name: Build and Test
        caches:
          - node
        script:
          - npm run build:prod
          - cp staticwebapp.config.json ./dist/staticwebapp.config.json
        artifacts:
          - 'dist/**'
    - step: 
        name: "Deploy to Azure"
        deployment: test
        script:
          - echo "$(ls -la)"
          - echo "$(ls -la ./dist)"
          - pipe: microsoft/azure-static-web-apps-deploy:main
            variables:
                APP_LOCATION: "$BITBUCKET_CLONE_DIR/dist"
                API_TOKEN: $AZURE_DEPLOYMENT_TOKEN